<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ì‡¼ë‹¤ìš´ ì‹¬íŒ ì•± í”„ë¡œ - í”„ë¡œì íŠ¸ ê´€ë¦¬, ì‹¬íŒ ì •ë³´, íƒ€ì„ì•„ì›ƒ ê¸°ëŠ¥">
    <title>ì‡¼ë‹¤ìš´ ì‹¬íŒ ì•± PRO</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        /* í…Œë§ˆ ë³€ìˆ˜ */
        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --bg-card: #ffffff;
            --text-primary: #202124;
            --text-secondary: #5f6368;
            --border: #dadce0;
            --primary: #1a73e8;
            --primary-hover: #1557b0;
            --success: #34a853;
            --warning: #fbbc04;
            --danger: #ea4335;
            --shadow: rgba(0,0,0,0.1);
        }
        
        body.enhanced-contrast {
            --bg-primary: #ffffff;
            --bg-secondary: #f0f0f0;
            --bg-card: #ffffff;
            --text-primary: #000000;
            --text-secondary: #333333;
            --border: #999999;
            --primary: #0066cc;
            --success: #228b22;
            --warning: #cc9900;
            --danger: #cc0000;
        }
        
        body.high-contrast {
            --bg-primary: #ffffff;
            --text-primary: #000000;
            --border: #000000;
            --primary: #0000ff;
            --success: #008000;
            --warning: #ff8c00;
            --danger: #ff0000;
        }
        
        body.inverted {
            --bg-primary: #000000;
            --bg-secondary: #1a1a1a;
            --bg-card: #000000;
            --text-primary: #ffffff;
            --text-secondary: #cccccc;
            --border: #666666;
            --primary: #66b3ff;
            --success: #66ff66;
            --warning: #ffcc66;
            --danger: #ff6666;
        }
        
        body.dark {
            --bg-primary: #121212;
            --bg-secondary: #1e1e1e;
            --bg-card: #2d2d2d;
            --text-primary: #e0e0e0;
            --text-secondary: #b0b0b0;
            --border: #444444;
            --primary: #4d9eff;
            --success: #4ade80;
            --warning: #fbbf24;
            --danger: #f87171;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: background 0.3s, color 0.3s;
        }
        
        *:focus {
            outline: 3px solid var(--primary);
            outline-offset: 2px;
        }
        
        .accessibility-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: var(--bg-card);
            border-bottom: 2px solid var(--border);
            padding: 8px 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
            box-shadow: 0 2px 8px var(--shadow);
        }
        
        .accessibility-controls {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .a11y-btn {
            min-width: 44px;
            min-height: 44px;
            padding: 8px 12px;
            border: 2px solid var(--border);
            background: var(--bg-secondary);
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            transition: all 0.2s;
        }
        
        .a11y-btn:hover, .a11y-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 70px 20px 20px;
            min-height: 100vh;
        }
        
        .header {
            text-align: center;
            padding: 24px;
            background: var(--bg-card);
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px var(--shadow);
        }
        
        .header h1 {
            font-size: 28px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 8px;
        }
        
        .card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px var(--shadow);
            border: 1px solid var(--border);
        }
        
        .card h2 {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 16px;
        }
        
        .btn {
            padding: 16px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            min-height: 48px;
            margin-bottom: 12px;
            transition: all 0.2s;
            background: var(--bg-secondary);
            color: var(--text-primary);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .btn-primary { 
            background: var(--primary); 
            color: white;
            border-color: var(--primary);
        }
        
        .btn-primary:hover:not(:disabled) {
            background: var(--primary-hover);
        }
        
        .btn-success { background: var(--success); color: white; border-color: var(--success); }
        .btn-warning { background: var(--warning); color: white; border-color: var(--warning); }
        .btn-danger { background: var(--danger); color: white; border-color: var(--danger); }
        
        input, select, textarea {
            width: 100%;
            padding: 14px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 16px;
            margin: 8px 0;
            background: var(--bg-primary);
            color: var(--text-primary);
        }
        
        input:focus, select:focus, textarea:focus {
            border-color: var(--primary);
        }
        
        label {
            display: block;
            font-weight: 600;
            margin-top: 12px;
            margin-bottom: 4px;
        }
        
        .score-grid {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 20px;
            align-items: center;
            margin: 24px 0;
        }
        
        .player-score {
            text-align: center;
        }
        
        .score-display {
            font-size: 72px;
            font-weight: 700;
            color: var(--primary);
            line-height: 1;
        }
        
        .player-name {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 12px;
        }
        
        .serve-indicator {
            margin-top: 8px;
            font-size: 14px;
            color: var(--success);
            font-weight: 600;
        }
        
        .timeout-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin: 16px 0;
        }
        
        .timeout-btn {
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 8px;
            background: var(--warning);
            color: white;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }
        
        .timeout-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }
        
        .timeout-count {
            font-size: 12px;
        }
        
        .foul-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 16px;
        }
        
        .foul-btn {
            padding: 16px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            min-height: 60px;
            background: var(--warning);
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }
        
        .goal-btn {
            background: var(--success);
            grid-column: 1 / -1;
            min-height: 80px;
            font-size: 18px;
        }
        
        .action-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 16px;
        }
        
        .folder-item, .match-item {
            padding: 16px;
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            border-radius: 8px;
            margin: 12px 0;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .folder-item:hover, .match-item:hover {
            border-color: var(--primary);
            box-shadow: 0 4px 12px var(--shadow);
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 32px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            text-align: center;
        }
        
        .timer-display {
            font-size: 96px;
            font-weight: 700;
            color: var(--primary);
            margin: 24px 0;
            font-variant-numeric: tabular-nums;
        }
        
        .timer-display.warning {
            color: var(--danger);
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .alert {
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 16px;
            font-weight: 600;
            border: 2px solid var(--success);
            background: var(--bg-secondary);
            text-align: center;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 12px;
        }
        
        .info-item {
            padding: 12px;
            background: var(--bg-secondary);
            border-radius: 6px;
            border: 1px solid var(--border);
        }
        
        .info-label {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }
        
        .info-value {
            font-weight: 600;
        }
        
        @media (max-width: 600px) {
            .score-display { font-size: 56px; }
            .timer-display { font-size: 72px; }
            .foul-grid { grid-template-columns: 1fr; }
            .info-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="accessibility-bar">
        <div style="font-weight: 600; font-size: 14px;">ì ‘ê·¼ì„±</div>
        <div class="accessibility-controls">
            <button class="a11y-btn" onclick="cycleTheme()" id="theme-btn">ëª¨ë“œ: ì¼ë°˜</button>
            <button class="a11y-btn" onclick="toggleVoice()" id="voice-btn">ğŸ”Š</button>
        </div>
    </div>

    <div id="app" class="container"></div>

    <!-- íƒ€ì„ì•„ì›ƒ ëª¨ë‹¬ -->
    <div id="timeout-modal" class="modal">
        <div class="modal-content">
            <h2 id="timeout-title">íƒ€ì„ì•„ì›ƒ</h2>
            <div id="timer-display" class="timer-display">60</div>
            <button class="btn btn-danger" onclick="closeTimeout()" style="width:100%">íƒ€ì„ì•„ì›ƒ ì¢…ë£Œ</button>
        </div>
    </div>

    <script>
        // ìŒì„± ì•ˆë‚´
        let voiceEnabled = localStorage.getItem('voice') !== 'false';
        let isTimeoutActive = false;
        
        function speak(text) {
            if (!voiceEnabled) return;
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'ko-KR';
            utterance.rate = 1.1;
            speechSynthesis.cancel();
            speechSynthesis.speak(utterance);
        }

        // í…Œë§ˆ ìˆœí™˜
        const themes = [
            { id: 'normal', name: 'ì¼ë°˜' },
            { id: 'enhanced-contrast', name: 'ëª…ë„ëŒ€ë¹„' },
            { id: 'high-contrast', name: 'ê³ ëŒ€ë¹„' },
            { id: 'inverted', name: 'ìƒ‰ë°˜ì „' },
            { id: 'dark', name: 'ë‹¤í¬' }
        ];
        let currentThemeIndex = 0;

        function cycleTheme() {
            currentThemeIndex = (currentThemeIndex + 1) % themes.length;
            const theme = themes[currentThemeIndex];
            
            document.body.className = theme.id === 'normal' ? '' : theme.id;
            localStorage.setItem('theme', theme.id);
            localStorage.setItem('themeIndex', currentThemeIndex);
            
            document.getElementById('theme-btn').textContent = `ëª¨ë“œ: ${theme.name}`;
            speak(`${theme.name} ëª¨ë“œë¡œ ë³€ê²½ë¨`);
        }

        function toggleVoice() {
            voiceEnabled = !voiceEnabled;
            localStorage.setItem('voice', voiceEnabled);
            speak(voiceEnabled ? 'ìŒì„± ì•ˆë‚´ ì¼œì§' : 'ìŒì„± ì•ˆë‚´ êº¼ì§');
            document.getElementById('voice-btn').style.opacity = voiceEnabled ? '1' : '0.5';
        }

        // ë°ì´í„° êµ¬ì¡°
        let projects = JSON.parse(localStorage.getItem('projects') || '[]');
        let currentProject = null;
        let currentMatch = null;
        let screen = 'home';
        let timeoutTimer = null;
        let timeoutSeconds = 60;

        function saveProjects() {
            localStorage.setItem('projects', JSON.stringify(projects));
        }

        const FOULS = [
            { id: 'irregular-serve', name: 'ë¶€ì • ì„œë¸Œ' },
            { id: 'centerboard', name: 'ì„¼í„°ë³´ë“œ' },
            { id: 'body-touch', name: 'ë°”ë””í„°ì¹˜' },
            { id: 'out', name: 'ì•„ì›ƒ' },
            { id: 'mask-touch', name: 'ê³ ê¸€í„°ì¹˜' },
            { id: 'delay', name: 'ì§€ì—°í–‰ìœ„' },
            { id: '2-second', name: '2ì´ˆë£°' }
        ];

        function render() {
            const app = document.getElementById('app');
            
            if (screen === 'home') {
                app.innerHTML = `
                    <div class="header">
                        <h1>âš« ì‡¼ë‹¤ìš´ ì‹¬íŒ ì•± PRO</h1>
                        <p>í”„ë¡œì íŠ¸ ê´€ë¦¬ Â· ì‹¬íŒ ì •ë³´ Â· íƒ€ì„ì•„ì›ƒ ê¸°ëŠ¥</p>
                    </div>
                    <div class="card">
                        <h2>í”„ë¡œì íŠ¸ ê´€ë¦¬</h2>
                        <button class="btn btn-primary" onclick="goTo('create-project')">ğŸ“ ìƒˆ í”„ë¡œì íŠ¸ ìƒì„±</button>
                        <button class="btn btn-primary" onclick="goTo('project-list')">ğŸ“‚ í”„ë¡œì íŠ¸ ëª©ë¡</button>
                    </div>
                `;
            }
            else if (screen === 'create-project') {
                app.innerHTML = `
                    <div class="card">
                        <h2>ìƒˆ í”„ë¡œì íŠ¸ ìƒì„±</h2>
                        <label>í”„ë¡œì íŠ¸ëª… *</label>
                        <input type="text" id="project-name" placeholder="ì˜ˆ: 2025 ì „êµ­ì¥ì• ì¸ì²´ìœ¡ëŒ€íšŒ">
                        <label>ë‚ ì§œ (ì„ íƒì‚¬í•­)</label>
                        <input type="text" id="project-date" placeholder="ì˜ˆ: 2025-03-15 ë˜ëŠ” 3ì›” 15ì¼">
                        <label>ì¥ì†Œ (ì„ íƒì‚¬í•­)</label>
                        <input type="text" id="project-location" placeholder="ì˜ˆ: ì„œìš¸ì¢…í•©ìš´ë™ì¥">
                        <label>ì„¤ëª… (ì„ íƒì‚¬í•­)</label>
                        <textarea id="project-desc" rows="3" placeholder="í”„ë¡œì íŠ¸ ì„¤ëª…"></textarea>
                        <div class="action-row">
                            <button class="btn btn-danger" onclick="goTo('home')">ì·¨ì†Œ</button>
                            <button class="btn btn-primary" onclick="createProject()">ìƒì„±</button>
                        </div>
                    </div>
                `;
            }
            else if (screen === 'project-list') {
                app.innerHTML = `
                    <div class="card">
                        <h2>í”„ë¡œì íŠ¸ ëª©ë¡</h2>
                        ${projects.length === 0 ? 
                            '<p style="text-align:center; padding:40px; color:var(--text-secondary)">ìƒì„±ëœ í”„ë¡œì íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.</p>' :
                            projects.map((p, i) => `
                                <div class="folder-item" onclick="selectProject(${i})">
                                    <h4>ğŸ“ ${p.name}</h4>
                                    <p style="color:var(--text-secondary); font-size:14px; margin-top:4px">
                                        ${p.date || 'ë‚ ì§œ ë¯¸ì •'} Â· ${p.location || 'ì¥ì†Œ ë¯¸ì •'} Â· ê²½ê¸° ${p.matches.length}ê°œ
                                    </p>
                                </div>
                            `).join('')
                        }
                        <button class="btn btn-primary" onclick="goTo('home')" style="margin-top:12px">ğŸ  í™ˆìœ¼ë¡œ</button>
                    </div>
                `;
            }
            else if (screen === 'project-detail') {
                const active = currentProject.matches.filter(m => m.status === 'active');
                const finished = currentProject.matches.filter(m => m.status === 'finished');
                
                app.innerHTML = `
                    <div class="card">
                        <h2>ğŸ“ ${currentProject.name}</h2>
                        <div class="info-grid">
                            <div class="info-item">
                                <div class="info-label">ë‚ ì§œ</div>
                                <div class="info-value">${currentProject.date || 'ë¯¸ì •'}</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">ì¥ì†Œ</div>
                                <div class="info-value">${currentProject.location || 'ë¯¸ì •'}</div>
                            </div>
                        </div>
                        ${currentProject.desc ? `<p style="margin-top:12px; color:var(--text-secondary)">${currentProject.desc}</p>` : ''}
                    </div>
                    <div class="card">
                        <h2>ê²½ê¸° ê´€ë¦¬</h2>
                        <button class="btn btn-primary" onclick="goTo('create-match')">â• ìƒˆ ê²½ê¸° ìƒì„±</button>
                        
                        ${active.length > 0 ? `
                            <h3 style="color:var(--success); margin:16px 0">ì§„í–‰ ì¤‘ì¸ ê²½ê¸°</h3>
                            ${active.map((m, i) => `
                                <div class="match-item" style="position:relative">
                                    <div onclick="selectMatch(${currentProject.matches.indexOf(m)})" style="cursor:pointer">
                                        <h4>${m.player1Name} vs ${m.player2Name}</h4>
                                        <p style="color:var(--text-secondary); font-size:14px; margin-top:4px">
                                            ì„¸íŠ¸ ${m.currentSet}/${m.sets} Â· ì£¼ì‹¬: ${m.mainReferee || 'ë¯¸ì •'}
                                        </p>
                                    </div>
                                    <button onclick="deleteMatch(event, ${currentProject.matches.indexOf(m)})" 
                                            style="position:absolute; top:12px; right:12px; min-width:40px; min-height:40px; padding:8px; background:var(--danger); color:white; border:none; border-radius:6px; cursor:pointer; font-weight:600;">
                                        ğŸ—‘ï¸
                                    </button>
                                </div>
                            `).join('')}
                        ` : ''}
                        
                        ${finished.length > 0 ? `
                            <h3 style="color:var(--text-secondary); margin:24px 0 16px">ì™„ë£Œëœ ê²½ê¸°</h3>
                            ${finished.map((m, i) => `
                                <div class="match-item" style="position:relative">
                                    <div onclick="selectMatch(${currentProject.matches.indexOf(m)})" style="cursor:pointer">
                                        <h4>${m.player1Name} vs ${m.player2Name}</h4>
                                        <p style="color:var(--text-secondary); font-size:14px; margin-top:4px">
                                            ì™„ë£Œ Â· ì£¼ì‹¬: ${m.mainReferee || 'ë¯¸ì •'}
                                        </p>
                                    </div>
                                    <button onclick="deleteMatch(event, ${currentProject.matches.indexOf(m)})" 
                                            style="position:absolute; top:12px; right:12px; min-width:40px; min-height:40px; padding:8px; background:var(--danger); color:white; border:none; border-radius:6px; cursor:pointer; font-weight:600;">
                                        ğŸ—‘ï¸
                                    </button>
                                </div>
                            `).join('')}
                        ` : ''}
                        
                        <button class="btn" onclick="goTo('project-list')" style="margin-top:12px">â† í”„ë¡œì íŠ¸ ëª©ë¡</button>
                    </div>
                `;
            }
            else if (screen === 'create-match') {
                app.innerHTML = `
                    <div class="card">
                        <h2>ìƒˆ ê²½ê¸° ìƒì„±</h2>
                        
                        <h3 style="margin-top:20px">ê²½ê¸° ì •ë³´</h3>
                        <label>ê²½ê¸° ìœ í˜• *</label>
                        <select id="match-type">
                            <option value="individual">ê°œì¸ì „</option>
                            <option value="team">íŒ€ì „</option>
                        </select>
                        <div id="sets-div">
                            <label>ì„¸íŠ¸ ìˆ˜ *</label>
                            <select id="sets">
                                <option value="3">3ì„¸íŠ¸</option>
                                <option value="5">5ì„¸íŠ¸</option>
                            </select>
                        </div>
                        
                        <h3 style="margin-top:20px">ì„ ìˆ˜ ì •ë³´</h3>
                        <label id="player1-label">ì„ ìˆ˜ 1 ì´ë¦„ *</label>
                        <input type="text" id="player1" placeholder="ì„ ìˆ˜ 1">
                        <label id="player2-label">ì„ ìˆ˜ 2 ì´ë¦„ *</label>
                        <input type="text" id="player2" placeholder="ì„ ìˆ˜ 2">
                        
                        <h3 style="margin-top:20px">ì‹¬íŒ ì •ë³´</h3>
                        <label>ì£¼ì‹¬</label>
                        <input type="text" id="main-referee" placeholder="ì£¼ì‹¬ ì´ë¦„">
                        <label>ë¶€ì‹¬</label>
                        <input type="text" id="assistant-referee" placeholder="ë¶€ì‹¬ ì´ë¦„">
                        
                        <h3 style="margin-top:20px">ì½”ì¹˜ ì •ë³´</h3>
                        <label id="coach1-label">ì„ ìˆ˜ 1 ì½”ì¹˜</label>
                        <input type="text" id="coach1" placeholder="ì½”ì¹˜ ì´ë¦„">
                        <label id="coach2-label">ì„ ìˆ˜ 2 ì½”ì¹˜</label>
                        <input type="text" id="coach2" placeholder="ì½”ì¹˜ ì´ë¦„">
                        
                        <div class="action-row">
                            <button class="btn btn-danger" onclick="goTo('project-detail')">ì·¨ì†Œ</button>
                            <button class="btn btn-primary" onclick="createMatch()">ê²½ê¸° ì‹œì‘</button>
                        </div>
                    </div>
                `;
                
                document.getElementById('match-type').onchange = (e) => {
                    const isTeam = e.target.value === 'team';
                    document.getElementById('sets-div').style.display = isTeam ? 'none' : 'block';
                    document.getElementById('player1-label').textContent = isTeam ? 'íŒ€ 1 ì´ë¦„ *' : 'ì„ ìˆ˜ 1 ì´ë¦„ *';
                    document.getElementById('player2-label').textContent = isTeam ? 'íŒ€ 2 ì´ë¦„ *' : 'ì„ ìˆ˜ 2 ì´ë¦„ *';
                    document.getElementById('coach1-label').textContent = isTeam ? 'íŒ€ 1 ì½”ì¹˜' : 'ì„ ìˆ˜ 1 ì½”ì¹˜';
                    document.getElementById('coach2-label').textContent = isTeam ? 'íŒ€ 2 ì½”ì¹˜' : 'ì„ ìˆ˜ 2 ì½”ì¹˜';
                };
            }
            else if (screen === 'match') {
                renderMatch();
            }
        }

        function renderMatch() {
            const set = currentMatch.setScores[currentMatch.currentSet - 1];
            const canEnd = Math.max(set.player1, set.player2) >= currentMatch.winScore && 
                          Math.abs(set.player1 - set.player2) >= 2;
            
            app.innerHTML = `
                <div class="card">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;">
                        <div style="font-weight:600;">ì„¸íŠ¸ ${currentMatch.currentSet}/${currentMatch.sets}</div>
                        <div style="font-size:12px; color:var(--text-secondary)">ì£¼ì‹¬: ${currentMatch.mainReferee || 'ë¯¸ì •'}</div>
                    </div>
                    
                    ${canEnd ? '<div class="alert">âœ… ì„¸íŠ¸ ì¢…ë£Œ ì¡°ê±´ ì¶©ì¡±! ì„¸íŠ¸ ì¢…ë£Œ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</div>' : ''}
                    
                    <div class="score-grid">
                        <div class="player-score">
                            <div class="player-name">${currentMatch.player1Name}</div>
                            <div class="score-display">${set.player1}</div>
                        </div>
                        <div style="font-size:24px; font-weight:700; color:var(--text-secondary)">VS</div>
                        <div class="player-score">
                            <div class="player-name">${currentMatch.player2Name}</div>
                            <div class="score-display">${set.player2}</div>
                        </div>
                    </div>
                    
                    <div style="text-align:center; padding:12px; background:var(--bg-secondary); border-radius:8px; margin-bottom:16px;">
                        <div class="serve-indicator">ğŸ¾ ${currentMatch.currentServe === 'player1' ? currentMatch.player1Name : currentMatch.player2Name} - ì„œë¸Œ ${currentMatch.serveCount + 1}íšŒì°¨</div>
                    </div>
                    
                    <h3 style="margin-bottom:8px;">â±ï¸ íƒ€ì„ì•„ì›ƒ</h3>
                    <div class="timeout-section">
                        <button class="timeout-btn" onclick="startTimeout('player1')" ${currentMatch.timeouts.player1 === 0 || isTimeoutActive ? 'disabled' : ''}>
                            ${currentMatch.player1Name} íƒ€ì„ì•„ì›ƒ
                            <span class="timeout-count">ë‚¨ì€ íšŸìˆ˜: ${currentMatch.timeouts.player1}</span>
                        </button>
                        <button class="timeout-btn" onclick="startTimeout('player2')" ${currentMatch.timeouts.player2 === 0 || isTimeoutActive ? 'disabled' : ''}>
                            ${currentMatch.player2Name} íƒ€ì„ì•„ì›ƒ
                            <span class="timeout-count">ë‚¨ì€ íšŸìˆ˜: ${currentMatch.timeouts.player2}</span>
                        </button>
                    </div>
                    
                    <h3 style="margin-top:24px; margin-bottom:12px;">ë“ì  ê¸°ë¡</h3>
                    
                    <!-- ê³¨ ë“ì  (ì¢Œìš° ë°°ì¹˜) -->
                    <div class="foul-grid">
                        <button class="foul-btn goal-btn" onclick="addScore('player1', 2, '${currentMatch.player1Name} ê³¨')" ${isTimeoutActive ? 'disabled' : ''}>
                            ${currentMatch.player1Name}<br>ê³¨ +2ì 
                        </button>
                        <button class="foul-btn goal-btn" onclick="addScore('player2', 2, '${currentMatch.player2Name} ê³¨')" ${isTimeoutActive ? 'disabled' : ''}>
                            ${currentMatch.player2Name}<br>ê³¨ +2ì 
                        </button>
                    </div>
                    
                    <!-- íŒŒìš¸ (ìƒëŒ€ ë“ì ) -->
                    <h4 style="margin:16px 0 8px; font-size:14px; color:var(--text-secondary);">íŒŒìš¸ (ìƒëŒ€ì—ê²Œ +1ì )</h4>
                    ${FOULS.map(f => `
                        <div class="foul-grid">
                            <button class="foul-btn" onclick="addScore('player2', 1, '${currentMatch.player1Name} ${f.name}')" ${isTimeoutActive ? 'disabled' : ''}>
                                ${currentMatch.player1Name}<br>${f.name}
                            </button>
                            <button class="foul-btn" onclick="addScore('player1', 1, '${currentMatch.player2Name} ${f.name}')" ${isTimeoutActive ? 'disabled' : ''}>
                                ${currentMatch.player2Name}<br>${f.name}
                            </button>
                        </div>
                    `).join('')}
                    
                    <div class="action-row">
                        <button class="btn btn-danger" onclick="undo()" ${currentMatch.history.length === 0 ? 'disabled' : ''}>â†©ï¸ ì·¨ì†Œ</button>
                        <button class="btn btn-success" onclick="endSet()">${currentMatch.currentSet < currentMatch.sets ? 'ì„¸íŠ¸ ì¢…ë£Œ' : 'ê²½ê¸° ì¢…ë£Œ'}</button>
                    </div>
                    <button class="btn" onclick="goTo('project-detail')" style="margin-top:12px">â† ê²½ê¸° ëª©ë¡</button>
                </div>
                
                ${currentMatch.history.length > 0 ? `
                    <div class="card" aria-live="polite" aria-atomic="false">
                        <h2>ê²½ê¸° ê¸°ë¡</h2>
                        <div id="match-history">
                            ${currentMatch.history.slice(0, 5).map(h => `
                                <div style="padding:12px; margin:8px 0; background:var(--bg-secondary); border-radius:6px; display:flex; justify-content:space-between">
                                    <span>${h.time} - ${h.player}</span>
                                    <span style="font-weight:700">${h.type} +${h.points}ì </span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                ` : ''}
            `;
        }

        function goTo(s) {
            screen = s;
            render();
        }

        function createProject() {
            const name = document.getElementById('project-name').value.trim();
            if (!name) {
                alert('í”„ë¡œì íŠ¸ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
                return;
            }
            
            const project = {
                id: Date.now(),
                name,
                date: document.getElementById('project-date').value,
                location: document.getElementById('project-location').value,
                desc: document.getElementById('project-desc').value,
                matches: [],
                createdAt: new Date().toISOString()
            };
            
            projects.push(project);
            saveProjects();
            goTo('project-list');
        }

        function selectProject(index) {
            currentProject = projects[index];
            goTo('project-detail');
        }

        function createMatch() {
            const type = document.getElementById('match-type').value;
            const player1 = document.getElementById('player1').value.trim();
            const player2 = document.getElementById('player2').value.trim();
            
            if (!player1 || !player2) {
                alert('ì„ ìˆ˜ ì´ë¦„ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”');
                return;
            }

            const sets = type === 'individual' ? parseInt(document.getElementById('sets').value) : 1;
            const match = {
                id: Date.now(),
                type,
                sets,
                player1Name: player1,
                player2Name: player2,
                mainReferee: document.getElementById('main-referee').value.trim(),
                assistantReferee: document.getElementById('assistant-referee').value.trim(),
                coach1: document.getElementById('coach1').value.trim(),
                coach2: document.getElementById('coach2').value.trim(),
                winScore: type === 'individual' ? 11 : 31,
                currentSet: 1,
                setScores: [{player1: 0, player2: 0}],
                currentServe: 'player1',
                serveCount: 0,
                timeouts: {
                    player1: type === 'individual' ? sets : 2,
                    player2: type === 'individual' ? sets : 2
                },
                status: 'active',
                history: [],
                createdAt: new Date().toISOString()
            };
            
            currentProject.matches.push(match);
            currentMatch = match;
            saveProjects();
            screen = 'match';
            render();
        }

        function selectMatch(index) {
            currentMatch = currentProject.matches[index];
            screen = 'match';
            render();
        }

        function addScore(player, points, type) {
            const set = currentMatch.setScores[currentMatch.currentSet - 1];
            if (player === 'player1') set.player1 += points;
            else set.player2 += points;
            
            currentMatch.history.unshift({
                time: new Date().toLocaleTimeString('ko-KR'),
                player: player === 'player1' ? currentMatch.player1Name : currentMatch.player2Name,
                type,
                points,
                set: currentMatch.currentSet
            });
            
            currentMatch.serveCount++;
            if (currentMatch.serveCount >= 2) {
                currentMatch.currentServe = currentMatch.currentServe === 'player1' ? 'player2' : 'player1';
                currentMatch.serveCount = 0;
            }
            
            const score = player === 'player1' ? set.player1 : set.player2;
            const playerName = player === 'player1' ? currentMatch.player1Name : currentMatch.player2Name;
            
            saveProjects();
            renderMatch();
            
            // ì„¸íŠ¸ ì¢…ë£Œ ì¡°ê±´ í™•ì¸ ë° ìë™ íŒì—…
            const diff = Math.abs(set.player1 - set.player2);
            const max = Math.max(set.player1, set.player2);
            if (max >= currentMatch.winScore && diff >= 2) {
                setTimeout(() => {
                    const setEndText = currentMatch.currentSet < currentMatch.sets 
                        ? `ì„¸íŠ¸ ${currentMatch.currentSet}ì„(ë¥¼) ì¢…ë£Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\ní˜„ì¬ ì ìˆ˜: ${set.player1} - ${set.player2}`
                        : `ê²½ê¸°ë¥¼ ì¢…ë£Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nìµœì¢… ì ìˆ˜: ${set.player1} - ${set.player2}`;
                    
                    if (confirm(setEndText)) {
                        endSet();
                    }
                }, 500);
            }
        }

        function undo() {
            if (currentMatch.history.length === 0) return;
            
            const last = currentMatch.history.shift();
            const set = currentMatch.setScores[currentMatch.currentSet - 1];
            
            if (last.player === currentMatch.player1Name) set.player1 -= last.points;
            else set.player2 -= last.points;
            
            currentMatch.serveCount--;
            if (currentMatch.serveCount < 0) {
                currentMatch.currentServe = currentMatch.currentServe === 'player1' ? 'player2' : 'player1';
                currentMatch.serveCount = 1;
            }
            
            saveProjects();
            renderMatch();
        }

        function endSet() {
            const set = currentMatch.setScores[currentMatch.currentSet - 1];
            const diff = Math.abs(set.player1 - set.player2);
            const max = Math.max(set.player1, set.player2);
            
            if (max < currentMatch.winScore) {
                alert(`${currentMatch.winScore}ì  ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤`);
                return;
            }
            if (diff < 2) {
                alert('2ì  ì´ìƒ ì°¨ì´ê°€ ë‚˜ì•¼ í•©ë‹ˆë‹¤');
                return;
            }
            
            if (currentMatch.currentSet < currentMatch.sets) {
                currentMatch.currentSet++;
                currentMatch.setScores.push({player1: 0, player2: 0});
                currentMatch.serveCount = 0;
                // ê°œì¸ì „ì€ ì„¸íŠ¸ë§ˆë‹¤ íƒ€ì„ì•„ì›ƒ ë¦¬ì…‹
                if (currentMatch.type === 'individual') {
                    currentMatch.timeouts = { player1: 1, player2: 1 };
                }
                saveProjects();
                renderMatch();
            } else {
                if (confirm('ê²½ê¸°ë¥¼ ì¢…ë£Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    currentMatch.status = 'finished';
                    currentMatch.finishedAt = new Date().toISOString();
                    saveProjects();
                    goTo('project-detail');
                }
            }
        }

        function startTimeout(player) {
            if (currentMatch.timeouts[player] === 0 || isTimeoutActive) return;
            
            isTimeoutActive = true;
            currentMatch.timeouts[player]--;
            saveProjects();
            
            const playerName = player === 'player1' ? currentMatch.player1Name : currentMatch.player2Name;
            document.getElementById('timeout-title').textContent = `${playerName} íƒ€ì„ì•„ì›ƒ`;
            document.getElementById('timeout-modal').classList.add('active');
            
            timeoutSeconds = 60;
            updateTimerDisplay();
            speak(`${playerName} íƒ€ì„ì•„ì›ƒ ì‹œì‘. 60ì´ˆ`);
            
            timeoutTimer = setInterval(() => {
                timeoutSeconds--;
                updateTimerDisplay();
                
                if (timeoutSeconds === 15) {
                    speak('15ì´ˆ ë‚¨ìŒ');
                    document.getElementById('timer-display').classList.add('warning');
                } else if (timeoutSeconds === 0) {
                    speak('íƒ€ì„ì•„ì›ƒ ì¢…ë£Œ');
                    closeTimeout();
                }
            }, 1000);
            
            renderMatch();
            renderMatch();
        }

        function updateTimerDisplay() {
            document.getElementById('timer-display').textContent = timeoutSeconds;
        }

        function closeTimeout() {
            clearInterval(timeoutTimer);
            document.getElementById('timeout-modal').classList.remove('active');
            document.getElementById('timer-display').classList.remove('warning');
            timeoutSeconds = 60;
            isTimeoutActive = false;
            renderMatch();
        }

        function deleteMatch(event, index) {
            event.stopPropagation();
            const match = currentProject.matches[index];
            const matchName = `${match.player1Name} vs ${match.player2Name}`;
            
            if (confirm(`ê²½ê¸°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\n${matchName}\nì„¸íŠ¸ ${match.currentSet}/${match.sets}`)) {
                currentProject.matches.splice(index, 1);
                saveProjects();
                render();
            }
        }

        // ì´ˆê¸°í™”
        const savedTheme = localStorage.getItem('theme') || 'normal';
        const savedThemeIndex = parseInt(localStorage.getItem('themeIndex')) || 0;
        currentThemeIndex = savedThemeIndex;
        
        if (savedTheme !== 'normal') {
            document.body.className = savedTheme;
        }
        
        const currentTheme = themes[currentThemeIndex];
        document.getElementById('theme-btn').textContent = `ëª¨ë“œ: ${currentTheme.name}`;
    document.getElementById('voice-btn').style.opacity = voiceEnabled ? '1' : '0.5';
        render();
    </script>
</body>
</html>
